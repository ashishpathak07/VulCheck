{% extends "base.html" %}

{% block content %}
<div class="scan-container">
    <h2>Vulnerability Scan</h2>
    
    {% if error %}
    <div class="alert error">{{ error }}</div>
    {% endif %}
    
    {% if message %}
    <div class="alert success">{{ message }}</div>
    {% endif %}
    
    <form method="POST" class="scan-form">
        <div class="form-group">
            <label for="target_url">Target URL:</label>
            <input type="url" id="target_url" name="target_url" 
                   value="{{ target_url or '' }}" 
                   placeholder="https://example.com" required>
        </div>
        
        <div class="form-group">
            <label>Scan Types:</label>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" name="scan_type" value="sql" checked>
                    SQL Injection
                </label>
                <label>
                    <input type="checkbox" name="scan_type" value="xss" checked>
                    Cross-Site Scripting (XSS)
                </label>
                <label>
                    <input type="checkbox" name="scan_type" value="csrf">
                    CSRF
                </label>
            </div>
        </div>
        
        <button type="submit" class="btn">Save Parameters</button>
    </form>
    
    {% if target_url %}
    <div class="scan-actions">
        <button id="startScan" class="btn primary">Start Scan</button>
        <div id="scanProgress" class="progress" style="display: none;">
            <p>Scanning in progress... Please wait.</p>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
$(document).ready(function() {
    $('#startScan').click(function() {
        $('#scanProgress').show();
        $(this).prop('disabled', true);
        
        $.post('/start_scan', function(data) {
            window.location.href = '/results';
        }).fail(function() {
            alert('Scan failed. Please try again.');
            $('#scanProgress').hide();
            $('#startScan').prop('disabled', false);
        });
    });
});
</script>
{% endblock %}